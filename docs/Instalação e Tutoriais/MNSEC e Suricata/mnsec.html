<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutorial de Instalação do Kytos</title>
    <link rel="stylesheet" href="mnsec.css">
</head>
<body>

    <header>
        <div class="logo-group">
            <div class="logo">
                <img src="imagens/logo.PNG" alt="HackInSDN Logo">
            </div>
        </div>
        <nav>
            <ul>
                <li><a href="../../Index/index.html">Home</a></li>
                <li><a href="../../Tela_Sobre/sobre.html">Quem Somos</a></li>
                <li><a href="../../Instalação e Tutoriais/tutorial.html">Tutoriais</a></li>
                <li><a href="../../Blog/blog.html">Publicações</a></li>
                <li><a href="../../https://dashboard.hackinsdn.ufba.br/login/" target="_blank">Portal</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">

        <section class="tutorial-content">
            <h1>Execução e Detecção de Ataques usando MnSec e Suricata</h1>
            <h2>Força Bruta</h2>
            <p>Existem várias técnicas de autenticação que podem ser usadas em ataques de Força Bruta:</p>
            <ul>
                <li>SSH: LOGIN (padrão), PLAIN, CRAM-MD5, DIGEST-MD5, NTLM</li>
                <li>Além disso, a criptografia TLS via STARTTLS pode ser aplicada com a opção TLS. Exemplo: <code>smtp://target/TLS:PLAIN</code>; Referência.</li>
                <li>IMAP: CLEAR ou APOP (padrão), LOGIN, PLAIN, CRAM-MD5, CRAM-SHA1, CRAM-SHA256, DIGEST-MD5, NTLM. Também suporta TLS como: <code>imap://target/TLS:PLAIN</code>; Referência.</li>
                <li>POP3: CLEAR (padrão), LOGIN, PLAIN, CRAM-MD5, CRAM-SHA1, CRAM-SHA256, DIGEST-MD5, NTLM. Também suporta TLS como: <code>pop3://target/TLS:PLAIN</code>; Referência.</li>
            </ul>
            <p>No uso documentado do Mininet-sec, a principal técnica de autenticação utilizada foi LOGIN. O pacote Python Honeypots, que está sendo usado no projeto Mininet-sec, suporta apenas a técnica de autenticação PLAIN e retorna uma mensagem de execução bem-sucedida, o que pode ser um problema, já que um dos objetivos do uso de honeypots é enganar o atacante e mantê-lo executando comandos, a fim de analisar melhor o processo de ataque. Algumas soluções para esse problema, como modificar o pacote Honeypots, podem ser aplicadas em versões futuras do Mininet-sec.</p>
        
            <h2>IMAP</h2>
            <p>Comando executado no diretório que continha a lista de senhas e logins:</p>
            <pre><code>sudo mnsecx o1 hydra -L top-usernames-shortlist.txt -P top-usernames-shortlist.txt imap://192.168.1.103/LOGIN -V -I -F</code></pre>
            <p>Regras que geraram alertas:</p>
            <pre><code>alert tcp $EXTERNAL_NET any -> $HOME_NET 143 (msg:”ET SCAN Rapid IMAP Connections - Possible Brute Force Attack”; flow:to_server; flags: S,12; threshold: type both, track by_src, count 30, seconds 60; classtype:misc-activity; sid:2002994; rev:7; metadata:created_at 2010_07_30, updated_at 2019_07_26;)</code></pre>
            <pre><code>alert tcp $EXTERNAL_NET any -> $HOME_NET 143 (msg: “Possible IMAP Brute Force attack”; flags:S; flow: to_server; threshold: type limit, track by_src, count 20, seconds 40; tcp.mss:1460; dsize:0; window:42340; classtype: credential-theft; sid: 100000137; rev:1;) (self-authored)</code></pre>
        
            <h2>SSH</h2>
            <p>Comando executado no diretório que continha a lista de senhas e logins:</p>
            <pre><code>sudo mnsecx o1 hydra -L top-usernames-shortlist.txt -P top-usernames-shortlist.txt ssh://192.168.1.103/LOGIN -V -I -F</code></pre>
            <p>Regra que gerou alertas:</p>
            <pre><code>alert tcp $EXTERNAL_NET any -> $HOME_NET 22 (msg:”ET SCAN Potential SSH Scan”; flow:to_server; flags:S,12; threshold: type both, track by_src, count 5, seconds 120; reference:url,en.wikipedia.org/wiki/Brute_force_attack; classtype:attempted-recon; sid:2001219; rev:20; metadata:created_at 2010_07_30, updated_at 2019_07_26;)</code></pre>
        
            <h2>POP3</h2>
            <p>Comando executado no diretório que continha a lista de senhas e logins:</p>
            <pre><code>sudo mnsecx o1 hydra -L top-usernames-shortlist.txt -P top-usernames-shortlist.txt pop3://192.168.1.103/LOGIN -V -I -F</code></pre>
            <p>Regra que gerou alertas:</p>
            <pre><code>alert tcp $EXTERNAL_NET any -> $HOME_NET 110 (msg: “Possible POP3 Brute Force attack”; flags:S; flow: to_server; threshold: type threshold, track by_src, count 5, seconds 20; classtype: credential-theft; sid: 100000138; rev:1;) (self-authored)</code></pre>
        
            <h2>TCP, UDP and ICMP Flood</h2>
            <p><code>--rand-source</code> é um parâmetro de ataques Hping3 que promove o uso de diversos endereços IP para executar floods. Nesse sentido, todos os ataques de flood ICMP, UDP e TCP acionaram regras ET DROP. Essas regras são baseadas na detecção de atividades relacionadas a endereços IP conhecidos por sua relação com ataques de flood.</p>
        
            <h2>Single IP Attacks</h2>
            <p>Usage example (Executed in mnsec shell):</p>
            <pre><code><mnsec-host> hping3 <protocol-or-tcp-flag> --flood -p <port-number> <ip-address></code></pre>
            <pre><code>o1 hping3 --icmp/--udp --flood --rand-source -p 567 --data 10 192.168.1.103 (h3 host ip address)</code></pre>
            <pre><code>o1 hping3 -S/-P/-U/-A/-F --flood --rand-source -p 567 --data 10 192.168.1.103 (h3 host ip address)</code></pre>
        
            <h2>TCP Flood</h2>
            <p>Usando portas que não têm relação específica com nenhuma função na internet:</p>
            <pre><code>alert tcp any 4444 -> any any (msg:”POSSBL SCAN M-SPLOIT R.SHELL TCP”; classtype:trojan-activity; sid:1000013; priority:1; rev:1;)</code></pre>
        
            <h2>SSH Port</h2>
            <p>Regra que gerou alertas:</p>
            <pre><code>alert tcp $EXTERNAL_NET any -> $HOME_NET 22 (msg:”ET SCAN Potential SSH Scan”; flow:to_server; flags:S,12; threshold: type both, track by_src, count 5, seconds 120; reference:url,en.wikipedia.org/wiki/Brute_force_attack; classtype:attempted-recon; sid:2001219; rev:20; metadata:created_at 2010_07_30, updated_at 2019_07_26;)</code></pre>
        
            <h2>POP3 Ports</h2>
            <p>Regra que gerou alertas:</p>
            <pre><code>alert tcp $EXTERNAL_NET any -> $HOME_NET 110 (msg: “Possible POP3 Brute Force attack”; flags:S; flow: to_server; threshold: type limit, track by_src, count 5, seconds 20; classtype: credential-theft; sid: 100000138; rev:1;) (self-authored)</code></pre>
            <pre><code>alert tcp $EXTERNAL_NET any -> $HOME_NET 110 (msg:”ET SCAN Rapid POP3 Connections - Possible Brute Force Attack”; flow:to_server; flags: S,12; threshold: type both, track by_src, count 30, seconds 120; classtype:misc-activity; sid:2002992; rev:7; metadata:created_at 2010_07_30, updated_at 2019_07_26;)</code></pre>
        
            <h2>IMAP Flood</h2>
            <p>Regras que geraram alertas:</p>
            <pre><code>alert tcp $EXTERNAL_NET any -> $HOME_NET 143 (msg:”ET SCAN Rapid IMAP Connections - Possible Brute Force Attack”; flow:to_server; flags: S,12; threshold: type both, track by_src, count 30, seconds 60; classtype:misc-activity; sid:2002994; rev:7; metadata:created_at 2010_07_30, updated_at 2019_07_26;)</code></pre>
        
            <h2>UDP Flood</h2>
            <p>Regra que gerou alertas:</p>
            <pre><code>alert udp any 4444 -> any any (msg:”POSSBL SCAN M-SPLOIT R.SHELL UDP”; classtype:trojan-activity; sid:1000014; priority:1; rev:1;)</code></pre>
        
            <h2>ICMP Flood</h2>
            <p>Não foi detectado por nenhuma regra, e as dificuldades relacionadas à detecção de ICMP Floods podem ser justificadas pelo desafio de diferenciar o tráfego legítimo envolvendo ICMP do tráfego malicioso.</p>
        
            <h2>Fragmentação</h2>
            <p>A promoção da fragmentação de pacotes no tráfego pode acontecer, por exemplo, das seguintes maneiras: Envio de um tráfego em que os pacotes têm um tamanho de dados maior que o MTU do computador alvo; Envio de pacotes com um tamanho de dados menor ou igual ao MTU do computador alvo, no entanto, usando técnicas para promover a fragmentação; Redução do MTU do computador. Os ataques de inundação com fragmentação de pacotes não foram detectados pelo Suricata, e há dificuldades para criar regras nesse sentido devido à dificuldade em obter informações sobre o tráfego relacionado a esse tipo de ataque. Além disso, remontar pacotes para análise é uma tarefa que consome recursos e tempo, aumentando a complexidade da investigação dos ataques.</p>
            <p>Conclusão Em geral, o Suricata fez uma boa detecção dos ataques promovidos, e também foi possível criar novas regras para os casos em que a detecção não estava acontecendo, e as regras personalizadas também tiveram um bom desempenho. Como algumas regras são baseadas nas características dos pacotes relacionados ao tráfego para os quais queremos criar alertas, algumas regras foram acionadas tanto para ataques de Força Bruta quanto para ataques de Inundação relacionados aos protocolos SSH, IMAP e POP3. As regras do Suricata para Possible Scan M-Sploit R.Shell TCP/UDP foram acionadas apenas para ataques de Inundação. Essas regras detectam tentativas de exploração da rede para detectar vulnerabilidades, a fim de implementar um shell remoto, ou seja, é um ataque relacionado a tentativas de obter acesso ao shell remoto em um computador alvo.</p>
        </section>
        
        

    </div>